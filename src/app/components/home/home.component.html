<!-- Search Bar -->
<div class="container my-5 p-5 bg-light rounded-4 shadow-sm">
  <div class="text-center mb-3">
    <h1 class="fw-bold">Welcome to our movie app</h1>
    <p class="text-muted lead">Millions of movies, TV shows, and people to discover. Explore now</p>
  </div>

  <div class="d-flex justify-content-center">
    <div class="input-group w-50">
      <input
        type="text"
        class="form-control form-control-lg rounded-start-pill"
        placeholder="Search for movies"
        [(ngModel)]="searchQuery"
        (keyup.enter)="searchMovies()"
      />
      <button class="btn btn-warning rounded-end-pill px-4 fw-bold" (click)="searchMovies()">
        Search
      </button>
    </div>
  </div>
</div>

<!-- Movies Grid -->
<div class="container my-5">
  <div class="mb-4">
    <h1 class="fw-bold">Now Playing</h1>
  </div>

  <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-4">
    <div class="col" *ngFor="let movie of movies">
      <div class="card h-100 shadow-sm border-0 rounded-4 overflow-hidden position-relative movie-card">

        <!-- Movie Poster -->
        <div class="position-relative">
          <img
            [routerLink]="['/details', movie.id]"
            class="card-img-top"
            [src]="movie.poster_path ? 'https://image.tmdb.org/t/p/w500' + movie.poster_path : './not_foundimage.png '"
            alt="{{ movie.title }}"
          />

          <!-- Rating Circle -->
          <div class="rating-circle">
            <svg viewBox="0 0 36 36" width="50" height="50">
              <path
                d="M18 2.0845
                  a 15.9155 15.9155 0 0 1 0 31.831
                  a 15.9155 15.9155 0 0 1 0 -31.831"
                stroke="#e6e6e6"
                stroke-width="4"
                fill="none"
              />
              <path
                [attr.stroke]="getStrokeColor(movie.vote_average)"
                [attr.stroke-dasharray]="(movie.vote_average / 10) * 100 + ', 100'"
                d="M18 2.0845
                  a 15.9155 15.9155 0 0 1 0 31.831
                  a 15.9155 15.9155 0 0 1 0 -31.831"
                stroke-width="4"
                fill="none"
                stroke-linecap="round"
              />
              <circle cx="18" cy="18" r="15" fill="#14532d" />
              <text
                x="18"
                y="20.5"
                text-anchor="middle"
                fill="#fff"
                font-size="8"
                dominant-baseline="middle"
              >
                {{ movie.vote_average * 10 | number : '1.0-0' }}%
              </text>
            </svg>
          </div>
        </div>

        <!-- Card Body -->
        <div class="card-body">
          <h6 class="card-title mt-3 fw-bold">{{ movie.title }}</h6>
          <div class="d-flex justify-content-between align-items-center">
            <p class="card-text text-muted small">{{ movie.release_date | date:'MMM dd, yyyy' }}</p>
            <i
              class="fs-5 bi"
              [ngClass]="isFavorite(movie) ? 'bi-heart-fill text-warning' : 'bi-heart'"
              style="cursor: pointer;"
              (click)="toggleFavorite(movie)"
            ></i>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ✅ Toast Notifications -->
<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1200">

  <!-- Error Toast -->
  <div
    class="toast align-items-center text-bg-danger border-0"
    [class.show]="errorMessage"
    role="alert"
    aria-live="assertive"
    aria-atomic="true"
  >
    <div class="d-flex">
      <div class="toast-body">
        {{ errorMessage }} <br />
        <small>Redirecting to Home...</small>
      </div>
      <button
        type="button"
        class="btn-close btn-close-white me-2 m-auto"
        (click)="errorMessage = ''"
      ></button>
    </div>
  </div>

  <!-- Success Toast -->
  <div
    class="toast align-items-center text-bg-success border-0"
    [class.show]="successMessage"
    role="alert"
    aria-live="assertive"
    aria-atomic="true"
  >
    <div class="d-flex">
      <div class="toast-body">
        {{ successMessage }}
      </div>
      <button
        type="button"
        class="btn-close btn-close-white me-2 m-auto"
        (click)="successMessage = ''"
      ></button>
    </div>
  </div>

  <!-- Info Toast -->
  <div
    class="toast align-items-center text-bg-info border-0"
    [class.show]="infoMessage"
    role="alert"
    aria-live="assertive"
    aria-atomic="true"
  >
    <div class="d-flex">
      <div class="toast-body">
        {{ infoMessage }}
      </div>
      <button
        type="button"
        class="btn-close btn-close-white me-2 m-auto"
        (click)="infoMessage = ''"
      ></button>
    </div>
  </div>

  <!--  Warning Toast  -->
  <div
    class="toast align-items-center text-bg-warning border-0"
    [class.show]="warningMessage"
    role="alert"
    aria-live="assertive"
    aria-atomic="true"
  >
    <div class="d-flex">
      <div class="toast-body">
        {{ warningMessage }}
      </div>
      <button
        type="button"
        class="btn-close btn-close-white me-2 m-auto"
        (click)="warningMessage = ''"
      ></button>
    </div>
  </div>
</div>

<!-- Pagination -->
<nav class="mt-5">
  <ul class="pagination justify-content-center">
    <!-- Previous -->
    <li class="page-item" [class.disabled]="currentPage === 1">
      <a
        class="page-link bg-warning text-dark border-0 mx-1 rounded-2"
        href="#"
        (click)="changePage(currentPage - 1)"
        >Previous</a
      >
    </li>

    <!-- Dynamic Pages -->
    <li *ngFor="let p of getPages()"
        class="page-item"
        [class.active]="p === currentPage"
        [class.disabled]="p === '...'">

      <!-- لو رقم -->
      <a *ngIf="p !== '...'"
          class="page-link text-dark"
          href="#"
          (click)="changePage(p)">
        {{ p }}
      </a>

      <!-- لو ... -->
      <span *ngIf="p === '...'" class="page-link text-muted">
        {{ p }}
      </span>
    </li>

    <!-- Next -->
    <li class="page-item" [class.disabled]="currentPage === totalPages">
      <a
        class="page-link bg-warning text-dark border-0 mx-1 rounded-2"
        href="#"
        (click)="changePage(currentPage + 1)"
        >Next</a
      >
    </li>
  </ul>
</nav>
